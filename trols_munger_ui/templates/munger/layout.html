          {% extends "layout.html" %}

    {% block custom_head_js %}
    <script src="/static/assets/js/utils.js"></script>

    <script type="text/javascript">
    // Update teams when section changes.
    //<![CDATA[
    $(window).load(function() {
        $(document).ready(function() {
            $('select[name=section]').on('change', function() {
                var section = $('select[name=section]').val()
                var comp_type = $('select[name=type]').val()
                if (comp_type == null) {
                    comp_type = ''
                }

                $('select[name=team] option[value!=""]').remove()
                $.getJSON($SCRIPT_ROOT + '/_teams?competition=saturday_am_spring_2015&type=' + comp_type + '&section=' + section, function(data) {
                    $.each(data, function(key, value) {
                        $.each(value, function(idx, team) {
                            $('<option>').val(team).text(team).appendTo('select[name=team]');
                        });
                    });
                });
            });
        });
    });
    //]]>
    </script>

    <script type="text/javascript">
    // Update teams on first load.
    //<![CDATA[
    $(document).ready(function() {
        var section = $('select[name=section]').val()
        if (section == null) {
            section = ''
        }
        var comp_type = $('select[name=type]').val()
        if (comp_type == null) {
            comp_type = ''
        }
        $('select[name=team] option[value!=""]').remove()

        $.getJSON($SCRIPT_ROOT + '/_teams?competition=saturday_am_spring_2015&type=' + comp_type + '&section=' + section, function(data) {
            var selected_team = getUrlParameter('team');
            $.each(data, function(key, value) {
                $.each(value, function(idx, team) {
                    if (typeof selected_team !== "undefined" && selected_team.replace(/\+/g, ' ') == team) {
                        $('<option>').val(team).text(team).attr('selected', 'selected').appendTo('select[name=team]');
                    }
                    else {
                        $('<option>').val(team).text(team).appendTo('select[name=team]');
                    }
                });
            });
        });
    });
    //]]>
    </script>

    <script type="text/javascript">
    //<![CDATA[
    $(window).load(function() {
        $(document).ready(function() {
            $('select[name=type]').on('change', function() {
                var comp_type = $('select[name=type]').val()
                var section = $('select[name=section]').val()
                if (section == null) {
                    section = ''
                }
                $('select[name=section] option[value!=""]').remove()
                $.getJSON($SCRIPT_ROOT + '/_sections?competition=saturday_am_spring_2015&type=' + comp_type, function(data) {
                    $.each(data, function(key, value) {
                        $.each(value, function(idx, section) {
                            $('<option>').val(section).text(section).appendTo('select[name=section]');
                        });
                    });
                });

                $('select[name=team] option[value!=""]').remove()
                $.getJSON($SCRIPT_ROOT + '/_teams?competition=saturday_am_spring_2015&type=' + comp_type + '&section=' + section, function(data) {
                    $.each(data, function(key, value) {
                        $.each(value, function(idx, team) {
                            $('<option>').val(team).text(team).appendTo('select[name=team]');
                        });
                    });
                });
            });
        });
    });
    //]]>
    </script>

    {% endblock custom_head_js %}

          {% block tabs %}
          <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
            {% block saturday_am_spring_2015_search %}
            <li class="active">
              <a href="#"
                 data-toggle="tab">
                <strong>NEJTA Saturday AM Spring 2015</strong>
              </a>
            </li>
            {% endblock saturday_am_spring_2015_search %}

            {% block saturday_am_autumn_2015_search %}
            {% endblock saturday_am_autumn_2015_search %}
          </ul>

            {% block tab_content %}
            <div class="panel panel-default">

              <!-- Default panel contents -->
              <div class="panel-heading">
                <form class="form-inline" action="/munger" method="get">
                  <div class="form-group">
                    <select class="form-control" name="event">
                      <option value=""{% if not result.event %} selected disabled {% endif %}>Event</option>
                      <option value="singles" {% if result.event == "singles" %}selected{% endif %}>singles</option>
                      <option value="doubles" {% if result.event == "doubles" %}selected{% endif %}>doubles</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <select class="form-control" name="type">
                      <option value=""{% if not result.comp_type %} selected disabled{% endif %}>Event type</option>
                      <option value="boys" {% if result.comp_type == "boys" %}selected{% endif %}>boys</option>
                      <option value="girls" {% if result.comp_type == "girls" %}selected{% endif %}>girls</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <select class="form-control" name="section">
                      <option value=""{% if not result.section %} selected disabled{% endif %}>Section</option>
                      {% for section_no in range(1, 27) %}
                      <option value="{{ section_no }}" {% if result.section == section_no|string %}selected{% endif %}>{{ section_no }}</option>
                      {%- endfor %}
                    </select>
                  </div>

                  <div class="form-group">
                    <select class="form-control" name="team">
                      <option value=""{% if not result.team %} selected disabled{% endif %}>Team</option>
                      {% if result.team %}
                      <option value="{{ result.team }}" selected>{{ result.team }}</option>
                      {% endif %}
                    </select>
                  </div>

                  <button type="submit" class="btn btn-success">
                    Get Rankings!
                  </button>
                </form>
              </div>

              <table class="table" style="margin-bottom: 0px;">
                <tbody>
                  {% set position = 1 %}
                  {% for player in result.players %}
                  <tr>
                    <td> 
                      <div class="panel panel-info" style="font-size: small; padding: 0px">
                        <div class="panel-heading">
                          <b>{{ position }}.&nbsp;</b>
                          <a id="{{ player[1].name | replace(' ', '%20') }}"
                             href="{{ url_for('stats', token=player[0]) }}">
                            {{ player[1].name }}
                          </a>
                          &nbsp;({{ player[1].team }})&nbsp;Section&nbsp;{{ player[1].section }}
                          <span class="pull-right">
                            <a href="#">
                              <img alt="top"
                                   src="{{ url_for('static', filename='images/arrow-up.png') }}"
                                   width="20">
                            </a>
                          </span>
                        </div>

                        <div class="panel-body" style="font-size: small; padding: 0px">
                          <table class="table" style="margin-bottom: 0px;">
                            <tbody>
                              <tr>
                                <td class="col-xs-5">
                                  <strong>Sets ({{ result.event }}) won/lost:</strong>
                                </td>
                                <td class="col-xs-7">
                                  {% set set_pc = 0 %}
                                  {% if player[1][result.event]['games_lost'] > 0 %}
                                  {% set set_pc = player[1][result.event]['games_won'] / player[1][result.event]['games_lost'] * 100 %}
                                  {% endif %}
                                  {{ player[1][result.event]['games_played'] }} for {{ player[1][result.event]['games_won'] }}/{{ player[1][result.event]['games_lost'] }} @ {{ '%0.2f' % set_pc }}%
                                </td>
                              </tr>
                              <tr>
                                <td class="col-xs-5">
                                  <strong>Games won/lost:</strong>
                                </td>
                                <td class="col-xs-7">
                                  {% set set_pc = 0 %}
                                  {% if player[1][result.event]['score_against'] > 0 %}
                                  {% set set_pc = player[1][result.event]['score_for'] / player[1][result.event]['score_against'] * 100 %}
                                  {% endif %}
                                  {{ player[1][result.event]['score_for'] }}/{{ player[1][result.event]['score_against'] }} @ {{ '%0.2f' % set_pc }}%
                                </td>
                              </tr>
                              {% if player[1].last_fixture|length %}
                              <tr>
                                <td class="col-xs-5">
                                  {% set last_played = player[1].last_fixture[0].fixture.match_round %}
                                  {% set last_played_date = "" %}
                                  {% if last_played in range(1, 15) %}
                                    {% set last_played = "Round " ~ last_played %}
                                    {% set last_played_date = " (" ~ player[1].last_fixture[0].fixture.date ~ ")" %}
                                  {% endif %}
                                  <strong>{{ last_played }}{{ last_played_date }}:</strong>
                                </td>
                                <td class="col-xs-7">
                                  {% for fixture in player[1].last_fixture %}
                                  {% if fixture.score_against == 6 %}
                                  <span style="color:red">
                                  {% endif %}
                                    {{ fixture.score_for }}-{{ fixture.score_against }}
                                  {% if fixture.score_against == 6 %}
                                  </span>
                                  {% endif %}
                                  {% endfor %}
  
                                  <!-- Last fixture home or away -->
                                  {% set home_team = player[1].last_fixture[0].fixture.home_team %}
                                  {% if player[1].team == home_team %}
                                  hosting {{  player[1].last_fixture[0].fixture.away_team }}
                                  {% else %}
                                  @ {{  player[1].last_fixture[0].fixture.home_team }}
                                  {% endif %}

                                  <span class="pull-right">
                                    <a href="{{ url_for('results', token=player[0]) }}">
                                      <img alt="Scores" src="{{ url_for('static', filename='images/scores.png') }}" width="80%">
                                    </a>
                                  </span>
                                </td>
                              </tr>
                              {% endif %}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </td> 
                  </tr> 
                  {% set position = position + 1 %}
                  {% endfor %}
                </tbody>
              </table>

            </div>
            {% endblock tab_content %}
          {% endblock tabs %}
